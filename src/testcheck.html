<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Calculator App</title>
    <link rel="stylesheet" href="main.css" />
</head>
<body>
    <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="testcheck.html">Check Answers</a>
        <a href="studentprofiles.html">Student Profiles</a>
        <a href="about.html">About</a>
    </nav>
    <br>
    <h1 id="title">Check Student Answers</h1>
    <br>
    
    <div class="test-selection">
        <h3>Select a Test to Check:</h3>
        <select id="testSelector">
            <option value="">-- Select a Test --</option>
        </select>
        <button id="loadTestBtn">Load Test</button>
    </div>
    
    <div id="testContent" class="test-content">
        <!-- Test content will be shown here -->
        <p>Select a test file and click "Load Test" to view the content.</p>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize with the title from the preload API
            const title_el = document.getElementById('title');
            title_el.innerText = "Test Calculator App";
            
            // References to DOM elements
            const testSelector = document.getElementById('testSelector');
            const loadTestBtn = document.getElementById('loadTestBtn');
            const testContent = document.getElementById('testContent');
            
            // Load available tests
            try {
                console.log("Requesting test files from main process...");
                const testFiles = await window.api.getTestFiles();
                console.log("Test files received:", testFiles);
                
                // Clear existing options except the first one
                while (testSelector.options.length > 1) {
                    testSelector.remove(1);
                }
                
                // Add each test file as an option
                if (testFiles && testFiles.length > 0) {
                    testFiles.forEach(file => {
                        const option = document.createElement('option');
                        option.value = file;
                        option.textContent = file;
                        testSelector.appendChild(option);
                    });
                } else {
                    testContent.innerHTML = '<p>No test files found.</p>';
                }
            } catch (error) {
                console.error('Error loading test files:', error);
                testContent.innerHTML = '<p>Failed to load test files: ' + error.message + '</p>';
            }
            
            // Handle loading test content
            loadTestBtn.addEventListener('click', async () => {
                const selectedTest = testSelector.value;
                
                if (!selectedTest) {
                    testContent.innerHTML = '<p>Please select a test file first.</p>';
                    return;
                }
                
                try {
                    console.log("Requesting content for test:", selectedTest);
                    const content = await window.api.getTestContent(selectedTest);
                    console.log("Content received for test:", selectedTest);
                    
                    // Format and display the test content
                    let htmlContent = '<h2>' + selectedTest + '</h2>';
                    htmlContent += '<pre>' + content + '</pre>';
                    
                    testContent.innerHTML = htmlContent;
                } catch (error) {
                    console.error('Error loading test content:', error);
                    testContent.innerHTML = '<p>Failed to load test content: ' + error.message + '</p>';
                }
            });
        });
    </script>
</body>
</html>